<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Setup - Shepherd Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="intro.html" class="active">Setup</a></li><li class="chapter-item affix "><li class="part-title">Docs</li><li class="chapter-item "><a href="UserGuide.html"><strong aria-hidden="true">1.</strong> User Guide</a></li><li class="chapter-item affix "><li class="part-title">ADR</li><li class="chapter-item "><a href="adr/0000-metrics-client-for-shepherd.html"><strong aria-hidden="true">2.</strong> Shepherd Metrics</a></li><li class="chapter-item affix "><li class="part-title">Scripts</li><li class="chapter-item "><a href="recoveryScript.html"><strong aria-hidden="true">3.</strong> Recovery Script</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Shepherd Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="contextual-services-shepherd"><a class="header" href="#contextual-services-shepherd">Contextual Services Shepherd</a></h1>
<p>This is a tool to manage dynamic settings for Contextual Services projects like
Merino and Contile. The settings managed here can be changed at runtime,
reducing the need for deployments of the services that use it.</p>
<h2 id="quick-start"><a class="header" href="#quick-start">Quick Start</a></h2>
<p>To use consvc-shepherd, you'll need a Python 3.11 development environment and
Poetry installed. To achieve this, it is recommended you use a Python virtual environment.</p>
<p>venv is a viable option, but for ease you can use pyenv-virtualenv as a plugin for
pyenv and virtual environments. Using virtualenv creates a <code>.python-version</code> file  in the project
directory and if you add <code>eval &quot;$(pyenv virtualenv-init -)&quot;</code> to your  <code>./bashrc</code> or <code>./zshrc</code>,
the environment will automatically be activated. See the <a href="https://github.com/pyenv/pyenv-virtualenv">pyenv-virtualenv</a>
documentation for more information.</p>
<p>Ex:</p>
<pre><code class="language-shell">export PATH=&quot;$HOME/.pyenv/bin:$PATH&quot;
eval &quot;$(pyenv init -)&quot;
eval &quot;$(pyenv virtualenv-init -)&quot;
</code></pre>
<p>You also need to ensure you have Postgres installed. You can select a distribution from
<a href="https://www.postgresql.org/download/">https://www.postgresql.org/download/</a>, use homebrew
or their EDB installer client.  Make sure to install version 14.7, or equivalent, and have
it running when developing for consvc-shepherd.</p>
<p>You'll want to make sure configuration files in the <code>.env</code> file match your database setup,
configuring the database name, user, host and password variables. See below for details.
You can configure the database using pgAdmin, cli or configuration files.</p>
<p>You'll need to specify some minimal configuration. Create a file <code>.env</code> and put the
following variables in it at least, if using the docker workflow. The simplest way is to
use <code>.env.example</code> and rename it to <code>env</code>:</p>
<pre><code class="language-shell">$ mv .env.example .env

# Variables to set in file
DEBUG=true
SECRET_KEY=keyboard-mash
DB_NAME=postgres
DB_USER=postgres
DB_HOST=localhost
DB_PASS=
</code></pre>
<p>Then, set up your virtual environment:</p>
<pre><code class="language-shell"># Prepare a virtual environment (customize this as you see fit).

# pyenv verison install
$ pyenv install 3.11

# pyenv virtualenv
$ pyenv virtualenv 3.11 shepherd # or whatever project name you like.
$ pyenv local shepherd

# venv
$ python -m venv .venv
$ source .venv/bin/activate
</code></pre>
<p>Install your dependencies:</p>
<pre><code class="language-shell">$ poetry install
</code></pre>
<p>With your environment ready, you can set up the Django site:</p>
<pre><code class="language-shell"># Set up Django
$ ./manage.py migrate
$ ./manage.py createsuperuser
</code></pre>
<p>After that is done, you can run the development server:</p>
<pre><code class="language-shell"># Activate the virtualenv, if not already active:
# pyenv virtualenv 
$ pyenv local shepherd
# venv
$ source .venv/bin/activate

# Start the app:
$ ./manage.py runserver

# To run on alternate port if in use:
$ ./manage.py runserver localhost:8001
</code></pre>
<p>This will start a development server that reloads on changes to the files. You
can access the configuration part of the site at
<code>[http://localhost:8000/admin](http://localhost:8000/admin).</code></p>
<h3 id="docker-set-up"><a class="header" href="#docker-set-up">Docker set up</a></h3>
<p>Start with building and get it up with:</p>
<pre><code>docker compose build
docker compose up
</code></pre>
<p>To create a user, shell into the container and run</p>
<pre><code>./manage.py createsuperuser
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->

                            <a rel="next" href="UserGuide.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

                    <a rel="next" href="UserGuide.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>


    </body>
</html>
