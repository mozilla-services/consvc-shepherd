<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Quick Start - Shepherd</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="intro.html">Service Overview</a></li><li class="chapter-item affix "><li class="part-title">Docs</li><li class="chapter-item expanded "><a href="quickStart.html" class="active"><strong aria-hidden="true">1.</strong> Quick Start</a></li><li class="chapter-item "><a href="metrics.html"><strong aria-hidden="true">2.</strong> Metrics</a></li><li class="chapter-item "><a href="operations/index.html"><strong aria-hidden="true">3.</strong> Operations and Runbooks</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="operations/auth.html"><strong aria-hidden="true">3.1.</strong> Authentication and Authorization</a></li><li class="chapter-item "><a href="operations/addAdvertisers.html"><strong aria-hidden="true">3.2.</strong> Add Advertisers</a></li><li class="chapter-item "><a href="operations/addAdvertiserPaths.html"><strong aria-hidden="true">3.3.</strong> Add Advertiser Paths</a></li><li class="chapter-item "><a href="operations/addPartners.html"><strong aria-hidden="true">3.4.</strong> Add Partners</a></li><li class="chapter-item "><a href="operations/createSovAllocations.html"><strong aria-hidden="true">3.5.</strong> Create SOV Allocations</a></li><li class="chapter-item "><a href="operations/createPublishSnapshots.html"><strong aria-hidden="true">3.6.</strong> Create and Publish Snapshots</a></li><li class="chapter-item "><a href="operations/rollback.html"><strong aria-hidden="true">3.7.</strong> Rollback</a></li><li class="chapter-item "><a href="operations/recoveryScript.html"><strong aria-hidden="true">3.8.</strong> Recover Snapshot</a></li><li class="chapter-item "><a href="operations/syncBoostrData.html"><strong aria-hidden="true">3.9.</strong> Sync Data from Boostr</a></li><li class="chapter-item "><a href="operations/syncBoostrDataCron.html"><strong aria-hidden="true">3.10.</strong> Sync Data from Boostr Cron Job</a></li></ol></li><li class="chapter-item "><li class="part-title">ADR</li><li class="chapter-item "><a href="adr/0000-metrics-client-for-shepherd.html"><strong aria-hidden="true">4.</strong> Shepherd Metrics</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Shepherd</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="quick-start-development-guide"><a class="header" href="#quick-start-development-guide">Quick Start Development Guide</a></h1>
<p>Shepherd is a grab-bag of Ad Operations tools, and currently consists of</p>
<ul>
<li><code>consvc_shepherd</code>: A full-stack Python Django app, as well as a json REST API</li>
<li><code>contile</code>: A Python Django app</li>
<li><code>ad-ops-dashboard</code>: A Node/Typescript React app, backed by the <code>consvc_shepherd</code> REST API</li>
</ul>
<h2 id="python-setup"><a class="header" href="#python-setup">Python setup</a></h2>
<p>To use consvc-shepherd, you'll need a Python 3.11 development environment with Poetry installed and Docker.</p>
<p>It is recommended to use <code>pyenv</code> and the <code>pyenv-virtualenv</code> plugin for your virtual environment.</p>
<ol>
<li>
<p>Install <code>pyenv</code> using the <a href="https://github.com/pyenv/pyenv#installation">latest documentation</a> for your platform.</p>
</li>
<li>
<p>Follow the instructions to install the <code>pyenv-virtualenv</code> plugin.
See the <a href="https://github.com/pyenv/pyenv-virtualenv">pyenv-virtualenv</a> documentation.</p>
</li>
<li>
<p>Ensure you've added <code>pyenv</code> and <code>pyenv-virtualenv</code> to your <code>PATH</code>:</p>
<p>Ex:</p>
<pre><code class="language-shell">export PATH=&quot;$HOME/.pyenv/bin:$PATH&quot;
eval &quot;$(pyenv init -)&quot;
eval &quot;$(pyenv virtualenv-init -)&quot;
</code></pre>
<p>To run consvc-shepherd, you'll need to specify some minimal configurations.
Use the existing <code>.env.example</code> and copy it to <code>.env</code>.</p>
<p>You'll want to make sure the environment variables in the <code>.env</code> file match your database setup, configuring the database name, user, host, and password.</p>
<p>It should appear as follows:</p>
<pre><code class="language-shell">$ cp .env.example .env

# Variables to set in file
DEBUG=true
SECRET_KEY=keyboard-mash
DB_NAME=postgres
DB_USER=postgres
DB_HOST=db
DB_PASS=postgres
</code></pre>
</li>
<li>
<p>Set up and enable your virtual environment:</p>
<pre><code class="language-shell"># pyenv version install
$ pyenv install 3.11

# pyenv virtualenv
$ pyenv virtualenv 3.11 shepherd # or whatever project name you like.
$ pyenv local shepherd # enables virtual env when you enter directory.
</code></pre>
</li>
<li>
<p>Install your dependencies:</p>
<pre><code class="language-shell">$ pip install poetry
$ poetry install
</code></pre>
</li>
<li>
<p><a href="https://docs.docker.com/engine/install/">Install Docker</a>, if not already installed.</p>
</li>
<li>
<p>Build the Docker image and start the container:</p>
<pre><code class="language-shell">docker compose up --build
</code></pre>
<p>The application will then be accessible at the following url: <a href="http://0.0.0.0:7001/">http://0.0.0.0:7001/</a>. The admin panel is available at <a href="http://0.0.0.0:7001/admin">http://0.0.0.0:7001/admin</a>.</p>
</li>
<li>
<p>Create database migrations and run migrations.</p>
<p>You may have to do this periodically as you modify or create models. Shell in as above and run the following commands:</p>
<pre><code class="language-shell">docker exec -it consvc-shepherd-app-1 bash # can also be run with `make debug`
python manage.py makemigrations
python manage.py migrate
</code></pre>
</li>
<li>
<p>Connect to the DB with <code>psql</code>.</p>
<p>While the Django Admin interface at <code>/admin</code> shows all the data in our DB in a human readable way, it may sometimes be
helpful to connect directly to the Shepherd DB while developing.</p>
<p><strong>Note</strong>: The values for the DB user and DB name come from the <code>.env</code> file.</p>
<pre><code class="language-shell">docker exec -it consvc-shepherd-db-1 psql -U postgres postgres
</code></pre>
</li>
<li>
<p>Seed Shepherd DB with random test data.</p>
<p>Shell into the <code>consvc-shepherd-app-1</code> container as mentioned above and run the following command:</p>
<pre><code class="language-shell">python manage.py seed
</code></pre>
<p>The script will output a success message once the database has been seeded:</p>
<pre><code class="language-shell">Successfully seeded the database with random data
</code></pre>
<p>Shell into <code>psql</code> and describe any of the DB tables (see example below), you should see that it contains some random data. Alternatively, you can look at the data by accessing the admin console at <a href="http://0.0.0.0:7001/admin">http://0.0.0.0:7001/admin</a>.</p>
<pre><code class="language-shell">SELECT * FROM consvc_shepherd_deliveredflight;
</code></pre>
</li>
<li>
<p>Import Boostr Deals and Products.</p>
<p>If you're working with the AdOps dashboard, you may want to pull in Boostr Deals and Products.</p>
<p>First, make sure you have the Boostr API credentials set in your <code>.env</code> file. You can find them in 1Password.</p>
<pre><code class="language-shell">BOOSTR_API_EMAIL=find-me-in-1password@mozilla.com
BOOSTR_API_PASS=i-am-in-1password-too
</code></pre>
<p>Then, run the script:</p>
<pre><code class="language-shell">docker exec -it consvc-shepherd-app-1 bash # can also be run with `make debug`
python manage.py sync_boostr_data https://app.boostr.com/api
</code></pre>
</li>
</ol>
<h2 id="nodetypescript-setup"><a class="header" href="#nodetypescript-setup">Node/Typescript setup</a></h2>
<p>To develop on the ad-ops-dashboard app, you'll need <code>node</code> and <code>npm</code> installed.</p>
<p>It is recommended to use a node version manager to allow for multiple <code>node</code>s on your system</p>
<ol>
<li>
<p>Install a node version manager. <a href="https://github.com/nvm-sh/nvm">nvm</a> is a great
choice if you're developing on a macOS with a POSIX-compliant shell.</p>
</li>
<li>
<p><code>cd ad-ops-dashboard</code></p>
</li>
<li>
<p>Install the <code>node</code> version specified in <code>ad-ops-dashboard/.nvmrc</code>:</p>
<pre><code class="language-shell">$ nvm install
</code></pre>
</li>
<li>
<p>Install <code>ad-ops-dashboard</code> app's dependencies:</p>
<pre><code class="language-shell">$ npm install
</code></pre>
</li>
<li>
<p>Set up the <code>ad-ops-dashboard</code> environment:</p>
<pre><code class="language-shell">$ cp .env.example .env
</code></pre>
</li>
<li>
<p>Spin up the <code>ad-ops-dashboard</code> app and REST api together:</p>
<pre><code class="language-shell">$ cd ..
$ docker-compose up --build
</code></pre>
<p>(You can also run the <code>ad-ops-dashboard</code> without the API via <code>npm run dev</code> from <code>./ad-ops-dashboard</code>)</p>
</li>
<li>
<p>Visit the home page at http://0.0.0.0:5173/</p>
</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="metrics.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="metrics.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>


    </body>
</html>
